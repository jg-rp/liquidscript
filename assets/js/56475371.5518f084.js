"use strict";(self.webpackChunkliquidscript_docs=self.webpackChunkliquidscript_docs||[]).push([[69257],{98453:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>o});var t=n(74848),s=n(28453);const r={},d="Objects and Drops",a={id:"introduction/objects-and-drops",title:"Objects and Drops",description:"When passed as globals to the fromString() and getTemplate() methods of Template and Environment, an object's properties will be available to template authors as global variables. LiquidScript will not call methods on render context objects unless explicitly whitelisted, instead treating them as undefined variables.",source:"@site/docs/introduction/objects-and-drops.md",sourceDirName:"introduction",slug:"/introduction/objects-and-drops",permalink:"/liquidscript/introduction/objects-and-drops",draft:!1,unlisted:!1,editUrl:"https://github.com/jg-rp/liquidscript/tree/docs/docs/introduction/objects-and-drops.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Render Context",permalink:"/liquidscript/introduction/render-context"},next:{title:"Undefined",permalink:"/liquidscript/introduction/undefined"}},l={},o=[{value:"Drop Protocol",id:"drop-protocol",level:2},{value:"toLiquid",id:"toliquid",level:3},{value:"liquidDispatch",id:"liquiddispatch",level:3},{value:"isLiquidCallable",id:"isliquidcallable",level:3}];function c(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.h1,{id:"objects-and-drops",children:"Objects and Drops"}),"\n",(0,t.jsxs)(i.p,{children:["When passed as ",(0,t.jsx)(i.code,{children:"globals"})," to the ",(0,t.jsx)(i.a,{href:"/liquidscript/api/classes/Template#fromstring",children:(0,t.jsx)(i.code,{children:"fromString()"})})," and ",(0,t.jsx)(i.a,{href:"/liquidscript/api/classes/Environment#gettemplate",children:(0,t.jsx)(i.code,{children:"getTemplate()"})})," methods of ",(0,t.jsx)(i.a,{href:"/liquidscript/api/classes/Template",children:(0,t.jsx)(i.code,{children:"Template"})})," and ",(0,t.jsx)(i.a,{href:"/liquidscript/api/classes/Environment",children:(0,t.jsx)(i.code,{children:"Environment"})}),", an object's properties will be available to template authors as ",(0,t.jsx)(i.a,{href:"/liquidscript/introduction/render-context",children:"global variables"}),". LiquidScript will ",(0,t.jsx)(i.strong,{children:"not"})," call methods on render context objects unless explicitly whitelisted, instead treating them as ",(0,t.jsx)(i.a,{href:"/liquidscript/introduction/undefined",children:"undefined"})," variables."]}),"\n",(0,t.jsxs)(i.p,{children:["Consider this example where we pass an array of product objects to ",(0,t.jsx)(i.code,{children:"renderSync()"}),"."]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-js",children:'import { Template } from "liquidscript";\n\nclass Product {\n  constructor(title, colors) {\n    this.title = title;\n    this.colors = colors;\n  }\n\n  save() {\n    console.log(`saved ${this.title}`);\n  }\n}\n\nconst data = {\n  products: [\n    new Product("A Shoe", ["blue", "red"]),\n    new Product("A Hat", ["grey", "brown"]),\n  ],\n};\n\nconst source = `\n{% for product in products %}\n  {{ product.title }} is available in {{ product.colors | join: \' and \' }}.\n  {{ product.save }}\n{% endfor %}\n{{ someFunction }}\n`;\n\nconsole.log(Template.fromString(source).renderSync(data));\n'})}),"\n",(0,t.jsxs)(i.p,{children:["Notice that ",(0,t.jsx)(i.code,{children:"{{ product.save }}"})," has produced no output and, if we were using an environment configured with ",(0,t.jsx)(i.code,{children:"StrictUndefined"}),", we would get a ",(0,t.jsx)(i.code,{children:"LiquidUndefinedError"})," with a message like ",(0,t.jsx)(i.code,{children:"LiquidUndefinedError: 'save' is undefined (<string>:4)"}),"."]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-plain",metastring:'title="output"',children:"A Shoe is available in blue and red.\n\nA Hat is available in grey and brown.\n\n"})}),"\n",(0,t.jsx)(i.h2,{id:"drop-protocol",children:"Drop Protocol"}),"\n",(0,t.jsx)(i.p,{children:'In LiquidScript, a "drop" is an object that implements some or all of the "drop protocol". When included in a Liquid render context, a drop can, for example, behave like a Liquid primitive, dynamically produce properties via a dispatching method or expose its methods as if they were simple properties.'}),"\n",(0,t.jsxs)(i.p,{children:["The drop protocol is nothing more than a set of conventions using well defined ",(0,t.jsx)(i.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol",children:"Symbols"}),". Those symbols are:"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(i.table,{children:[(0,t.jsx)(i.thead,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.th,{children:"Property"}),(0,t.jsx)(i.th,{children:"Description"})]})}),(0,t.jsxs)(i.tbody,{children:[(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.a,{href:"#toliquid",children:(0,t.jsx)(i.code,{children:"[toLiquid]"})})}),(0,t.jsxs)(i.td,{children:["A function valued property that is called to convert an object to its corresponding Liquid value. ",(0,t.jsx)(i.code,{children:"[toLiquid]"})," is passed the active render context as its only argument."]})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.a,{href:"/liquidscript/api/variables/toLiquidSync",children:(0,t.jsx)(i.code,{children:"[toLiquidSync]"})})}),(0,t.jsxs)(i.td,{children:["A synchronous version of ",(0,t.jsx)(i.code,{children:"[toLiquid]"})]})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.a,{href:"/liquidscript/api/variables/toLiquidPrimitive",children:(0,t.jsx)(i.code,{children:"[toLiquidPrimitive]"})})}),(0,t.jsx)(i.td,{children:"A function valued property that is called to convert an object to its corresponding Liquid primitive value. The return value of this function will be used in Liquid comparison expressions."})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.a,{href:"/liquidscript/api/variables/toLiquidString",children:(0,t.jsx)(i.code,{children:"[toLiquidString]"})})}),(0,t.jsxs)(i.td,{children:["A function valued property that is called to convert an object to its Liquid specific string representation. This function will take priority over ",(0,t.jsx)(i.code,{children:"toString()"})," when an object is output or passed to a string filter."]})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.a,{href:"/liquidscript/api/variables/toLiquidHtml",children:(0,t.jsx)(i.code,{children:"[toLiquidHtml]"})})}),(0,t.jsxs)(i.td,{children:["A function valued property that is called to convert an object to an HTML-safe string representation. When HTML auto-escaping is enabled, the return value of this function will take priority over ",(0,t.jsx)(i.code,{children:"[toLiquidString]"})," and ",(0,t.jsx)(i.code,{children:"toString()"}),", and it will not be escaped."]})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.a,{href:"#isliquidcallable",children:(0,t.jsx)(i.code,{children:"[isLiquidCallable]"})})}),(0,t.jsx)(i.td,{children:"A function valued property that is called to test a method name against a set of whitelisted methods that Liquid can call. A method name is passed as the only argument, and a boolean return value is expected. Liquid callable methods are not passed any arguments."})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.a,{href:"#liquiddispatch",children:(0,t.jsx)(i.code,{children:"[liquidDispatch]"})})}),(0,t.jsxs)(i.td,{children:["A function valued property that is called in the event that a property is missing from an object. The name of the missing property is passed as the only argument. This function is expected to return a Promise and should throw an ",(0,t.jsx)(i.code,{children:"InternalKeyError"})," if the named property is unavailable."]})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.a,{href:"/liquidscript/api/variables/liquidDispatchSync",children:(0,t.jsx)(i.code,{children:"[liquidDispatchSync]"})})}),(0,t.jsxs)(i.td,{children:["A synchronous version of ",(0,t.jsx)(i.code,{children:"[liquidDispatch]"}),"."]})]})]})]}),"\n",(0,t.jsx)(i.h3,{id:"toliquid",children:"toLiquid"}),"\n",(0,t.jsxs)(i.p,{children:["This example demonstrates how one might use ",(0,t.jsx)(i.a,{href:"/liquidscript/api/variables/toLiquid",children:(0,t.jsx)(i.code,{children:"toLiquid"})})," to implement a lazy loading user object."]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-typescript",children:'import { Liquidable, toLiquid } from "liquidscript";\n\ntype User = { firstName: string; lastName: string };\n\nclass LazyUserDrop implements Liquidable {\n  private obj?: User;\n  constructor(private userId: string) {}\n\n  async queryDatabase(): Promise<User> {\n    // Do database IO here.\n    return { firstName: "John", lastName: "Smith" };\n  }\n\n  async [toLiquid](): Promise<User> {\n    if (this.obj === undefined) this.obj = await this.queryDatabase();\n    return this.obj;\n  }\n}\n'})}),"\n",(0,t.jsx)(i.h3,{id:"liquiddispatch",children:"liquidDispatch"}),"\n",(0,t.jsxs)(i.p,{children:["Here we define a class implementing a ",(0,t.jsx)(i.a,{href:"/liquidscript/api/variables/liquidDispatchSync",children:(0,t.jsx)(i.code,{children:"liquidDispatchSync"})})," method, which will catch all attempts to access undefined properties on instances of that class."]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-typescript",children:'import {\n  LiquidDispatchableSync,\n  liquidDispatchSync,\n  InternalKeyError,\n} from "liquidscript";\n\nclass User implements LiquidDispatchableSync {\n  #data: Map<string, string | number>;\n  constructor(data: Map<string, string | number>) {\n    this.#data = data;\n  }\n\n  [liquidDispatchSync](name: string): string | number {\n    if (this.#data.has(name)) return this.#data.get(name);\n    throw new InternalKeyError(`User.${name}`);\n  }\n}\n'})}),"\n",(0,t.jsxs)(i.p,{children:["When in an async context, if ",(0,t.jsx)(i.code,{children:"liquidDispatch"})," is not defined, LiquidScript will fall back to ",(0,t.jsx)(i.code,{children:"liquidDispatchSync"})," if it is available."]}),"\n",(0,t.jsx)(i.h3,{id:"isliquidcallable",children:"isLiquidCallable"}),"\n",(0,t.jsxs)(i.p,{children:["We can tell LiquidScript to call an object's methods by implementing an ",(0,t.jsx)(i.a,{href:"/liquidscript/api/variables/isLiquidCallable",children:(0,t.jsx)(i.code,{children:"isLiquidCallable"})})," method. If this method returns ",(0,t.jsx)(i.code,{children:"true"}),", LiquidScript can call the named method without any arguments."]}),"\n",(0,t.jsxs)(i.p,{children:["This example user class would allow LiquidScript to call ",(0,t.jsx)(i.code,{children:"fullName()"}),", but not ",(0,t.jsx)(i.code,{children:"save()"}),". Note that a ",(0,t.jsx)(i.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/get",children:"getter"})," method/property would work equally as well."]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-typescript",children:'import { Template, LiquidCallable, isLiquidCallable } from "liquidscript";\n\nclass User implements LiquidCallable {\n  constructor(public firstName: string, public lastName: string) {}\n\n  fullName(): string {\n    return `${this.firstName} ${this.lastName}`;\n  }\n\n  save() {\n    console.log(`saved user ${this.fullName()}`);\n  }\n\n  [isLiquidCallable](name: string): boolean {\n    return name === "fullName";\n  }\n}\n'})})]})}function h(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,i,n)=>{n.d(i,{R:()=>d,x:()=>a});var t=n(96540);const s={},r=t.createContext(s);function d(e){const i=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),t.createElement(r.Provider,{value:i},e.children)}}}]);